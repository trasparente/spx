name: Fetch Save and Autocommit
on:
  schedule:
    # Run at 00:01 06:01 12:01 18:01 UTC every day
    - cron: '1 0/6 * * *'

jobs:
  update:
    name: Update
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2.3.1

      # SpaceX-API
      - name: Fetch and save launches
        uses: gautemo/fetch-api-data-action@1.1.0
        with:
          url: 'https://api.spacexdata.com/v4/launches'
          file: '_data/launches.json'
      - name: Fetch and save cores
        uses: gautemo/fetch-api-data-action@1.1.0
        with:
          url: 'https://api.spacexdata.com/v4/cores'
          file: '_data/cores.json'
      - name: Fetch and save rockets
        uses: gautemo/fetch-api-data-action@1.1.0
        with:
          url: 'https://api.spacexdata.com/v4/rockets'
          file: '_data/rockets.json'
      - name: Fetch and save payloads
        uses: gautemo/fetch-api-data-action@1.1.0
        with:
          url: 'https://api.spacexdata.com/v4/payloads'
          file: '_data/payloads.json'
      - name: Fetch and save capsules
        uses: gautemo/fetch-api-data-action@1.1.0
        with:
          url: 'https://api.spacexdata.com/v4/capsules'
          file: '_data/capsules.json'
      - name: Fetch and save dragons
        uses: gautemo/fetch-api-data-action@1.1.0
        with:
          url: 'https://api.spacexdata.com/v4/dragons'
          file: '_data/dragons.json'
      - name: Fetch and save launchpads
        uses: gautemo/fetch-api-data-action@1.1.0
        with:
          url: 'https://api.spacexdata.com/v4/launchpads'
          file: '_data/launchpads.json'
      - name: Fetch and save landpads
        uses: gautemo/fetch-api-data-action@1.1.0
        with:
          url: 'https://api.spacexdata.com/v4/landpads'
          file: '_data/landpads.json'
      - name: Fetch and save crews
        uses: gautemo/fetch-api-data-action@1.1.0
        with:
          url: 'https://api.spacexdata.com/v4/crew'
          file: '_data/crew.json'

      # Launch Library API
      # ------------------

      # Echo datetime
      - name: Get current date
        id: date
        run: echo "$(date +'%Y-%m-%dT%H:%M:%SZ')"

      # Launch Agency
      - name: LL - Fetch and save SpaceX Agency
        uses: gautemo/fetch-api-data-action@1.1.0
        with:
          url: 'https://ll.thespacedevs.com/2.2.0/agencies/121/?format=json&mode=detailed&search=SpaceX'
          file: '_data/ll/agency.json'

      # Upcoming launches
      # https://ll.thespacedevs.com/2.2.0/launch/?format=json&mode=detailed&net__gt=2022-08-29T12:25:41Z&ordering=net&lsp__ids=121
      #------------------
      - name: LL - Fetch and save upcoming 10 launches
        uses: gautemo/fetch-api-data-action@1.1.0
        with:
          url: 'https://ll.thespacedevs.com/2.2.0/launch/upcoming/?format=json&lsp__id=121&ordering=net&mode=detailed'
          file: '_data/ll/upcoming.json'

      # Previous launches
      # https://ll.thespacedevs.com/2.2.0/launch/?mode=detailed&net__lt=2022-08-29T12:25:41Z&ordering=-net&lsp__ids=121
      # -----------------
      - name: LL - Fetch and save previous 10 launches
        uses: gautemo/fetch-api-data-action@1.1.0
        with:
          url: 'https://ll.thespacedevs.com/2.2.0/launch/previous/?format=json&lsp__id=121&ordering=-net&mode=detailed'
          file: '_data/ll/previous.json'

      # Last launch Crew
      - name: get launch crew
        id: get_crew
        uses: kekedaine/github-action-json-property-by-lodash@0.2.0
        with:
          path: '_data/ll/previous.json'
          prop_path: 'results[0].rocket.spacecraft_stage.launch_crew'
      # Echo Crew
      - name: Echo crew
        id: echo_crew
        run: echo "$(steps.get_crew.outputs.prop)"

      # Landing Pads
      # -----------------

      # LZ-1
      - name: LL - Fetch and save landing zone 1
        uses: gautemo/fetch-api-data-action@1.1.0
        with:
          url: 'https://ll.thespacedevs.com/2.2.0/config/landinglocation/4/?format=json'
          file: '_data/ll/landing_pads/lz1.json'

      # LZ-2
      - name: LL - Fetch and save landing zone 2
        uses: gautemo/fetch-api-data-action@1.1.0
        with:
          url: 'https://ll.thespacedevs.com/2.2.0/config/landinglocation/5/?format=json'
          file: '_data/ll/landing_pads/lz2.json'

      # LZ-4
      - name: LL - Fetch and save landing zone 4
        uses: gautemo/fetch-api-data-action@1.1.0
        with:
          url: 'https://ll.thespacedevs.com/2.2.0/config/landinglocation/7/?format=json'
          file: '_data/ll/landing_pads/lz4.json'

      # LZ
      - name: LL - Fetch and save starship landing zone
        uses: gautemo/fetch-api-data-action@1.1.0
        with:
          url: 'https://ll.thespacedevs.com/2.2.0/config/landinglocation/14/?format=json'
          file: '_data/ll/landing_pads/lz.json'

      # OCISLY
      - name: LL - Fetch and save OCISLY
        uses: gautemo/fetch-api-data-action@1.1.0
        with:
          url: 'https://ll.thespacedevs.com/2.2.0/config/landinglocation/1/?format=json'
          file: '_data/ll/landing_pads/ocisly.json'

      # ASOG
      - name: LL - Fetch and save ASOG
        uses: gautemo/fetch-api-data-action@1.1.0
        with:
          url: 'https://ll.thespacedevs.com/2.2.0/config/landinglocation/17/?format=json'
          file: '_data/ll/landing_pads/asog.json'

      # JRTI
      - name: LL - Fetch and save JRTI
        uses: gautemo/fetch-api-data-action@1.1.0
        with:
          url: 'https://ll.thespacedevs.com/2.2.0/config/landinglocation/3/?format=json'
          file: '_data/ll/landing_pads/jrti.json'

      # GOM
      - name: LL - Fetch and save GOM
        uses: gautemo/fetch-api-data-action@1.1.0
        with:
          url: 'https://ll.thespacedevs.com/2.2.0/config/landinglocation/16/?format=json'
          file: '_data/ll/landing_pads/gom.json'

      # COMMIT
      # ------
      - name: Git Auto Commit
        uses: stefanzweifel/git-auto-commit-action@v4.8.0
